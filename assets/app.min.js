(function(){window.pledgeit=window.pledgeit||{},window.pledgeit.services=window.pledgeit.services||{},window.birdiesforstjude=window.birdiesforstjude||{},window.birdiesforstjude.views=window.birdiesforstjude.views||{}}).call(this),pledgeit.services.LeaderboardService=function(){function e(){this._initialize()}return e.prototype={_campaignEndpoint:"https://pledgeit.org/api-public/widgets/campaigns",_templateEndpoint:"https://pledgeit.org/api-public/widgets/templates",_initialize:function(){String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var i=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>i.length)&&(t=i.length),t-=e.length;var r=i.indexOf(e,t);return-1!==r&&r===t})},getCampaign:function(e,t){this._makeRequest(this._campaignEndpoint+"/"+e,t)},getTemplate:function(e,t){this._makeRequest(this._templateEndpoint+"/"+e,t)},_makeRequest:function(e,i){$.ajax({crossDomain:!0,dataType:"json",method:"GET",contentType:"text/plain",url:e,success:function(e){var t=e;i.onSuccess&&i.onSuccess(t)}})}},e}(),function(n){n.fn.reOrder=function(e,t,i){if(e)for(var r=0;r<e.length;r++)e[r]=n('[bd-name="'+e[r]+'"]'),i&&e[r].find("[bd-rank]").text(r+1),t.append(e[r])}}(jQuery);var services=pledgeit.services,views=birdiesforstjude.views;birdiesforstjude.views.MainView=function(){function e(){this._initialize(),this._attachEvents()}return e.prototype={_$golferLeaderboard:null,_leaderboardService:null,_itemsPerPage:1,_initialize:function(){this._$golferLeaderboard=$("[bd-leaderboard]"),this._leaderboardService=new services.LeaderboardService,this._getStats(),this._getGolfers(),window.Selectize&&$("select[selectize]").each($.proxy(function(e,t){$(t).selectize({onChange:$.proxy(this._handleSortChange,this,t)})},this))},_attachEvents:function(){$("[bd-show-more").on("click",$.proxy(this._handleShowMoreClick,this))},_getStats:function(){this._leaderboardService.getTemplate("birdiesforstjude",{onSuccess:$.proxy(function(e){$("[bd-total-stats]").text(this._getValue(e.amountRaised)).removeClass("-preload")},this)})},_getGolfers:function(){birdies=0,promises=[],this._$golferLeaderboard.find("[bd-slug]").each($.proxy(function(e,i){promises.push(new Promise($.proxy(function(t,e){this._leaderboardService.getCampaign(i.getAttribute("bd-slug"),{onSuccess:$.proxy(function(e){$target=$(i),$target.find("[bd-amount]").text(this._getValue(e.amountRaised)).removeClass("-preload"),$target.find("[bd-performance]").text(e.performanceTotal).removeClass("-preload"),$target.find("[bd-donate]").attr("href",e.url+"/pledge").removeClass("-preload"),birdies+=e.performanceTotal,t()},this)})},this)))},this)),Promise.all(promises).then($.proxy(function(){$("[bd-birdie-stats]").text(birdies).removeClass("-preload"),this._$golferLeaderboard.find("[bd-slug]").reOrder(this._getSort("rank",this._$golferLeaderboard.find("[bd-slug]")),this._$golferLeaderboard,!0),this._showMore()},this))},_getSort:function(e,t){var i=t.map(function(e,t){var i=$(t);return{amount:parseFloat(i.find("[bd-amount]").text().replace(/[,\$]/g,"")),birdies:parseFloat(i.find("[bd-performance]").text()),name:i.attr("bd-name")}});switch(i.sort(function(e,t){var i=e.name.toLowerCase(),r=t.name.toLowerCase();return i<r?-1:r<i?1:0}),e){case"birdies":i.sort(function(e,t){return t.birdies-e.birdies});break;case"rank":i.sort(function(e,t){return e.amount-t.amount})}return i.map(function(e,t){return t.name})},_getValue:function(e){return"$"+Number(parseFloat(e.replace(/[,\$]/g,"")).toFixed(0)).toLocaleString()},_showMore:function(){this._$golferLeaderboard.find("[bd-slug]").filter(":hidden").slice(0,this._itemsPerPage).removeClass("-preload")},_handleGolferSuccess:function(e,t){t.find("[bd-amount]").text("$"+e.amountRaised).removeClass("-preload")},_handleStatSuccess:function(e,t){t.text("$"+e.amountRaised).removeClass("-preload")},_handleSortChange:function(e,t){$list=$(e).closest("section").find("[bd-golfers]"),$list.reOrder(this._getSort(t,$list))},_handleShowMoreClick:function(e){e.preventDefault(),this._showMore(),$(e.currentTarget).toggle(0!==this._$golferLeaderboard.find("[bd-slug]").filter(":hidden").length)}},e}(),$(function(){new birdiesforstjude.views.MainView});