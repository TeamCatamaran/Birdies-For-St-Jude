(function(){window.pledgeit=window.pledgeit||{},window.pledgeit.services=window.pledgeit.services||{},window.birdiesforstjude=window.birdiesforstjude||{},window.birdiesforstjude.views=window.birdiesforstjude.views||{}}).call(this),pledgeit.services.LeaderboardService=function(){function e(){this._initialize()}return e.prototype={_campaignEndpoint:"https://pledgeit.org/api-public/widgets/campaigns",_templateEndpoint:"https://pledgeit.org/api-public/widgets/templates",_initialize:function(){String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;var i=r.indexOf(e,t);return-1!==i&&i===t})},getCampaign:function(e,t){this._makeRequest(this._campaignEndpoint+"/"+e,t)},getTemplate:function(e,t){this._makeRequest(this._templateEndpoint+"/"+e,t)},_makeRequest:function(e,r){$.ajax({crossDomain:!0,dataType:"json",method:"GET",contentType:"text/plain",url:e,success:function(e){var t=e;r.onSuccess&&r.onSuccess(t)}})}},e}(),function(i){i.fn.reOrder=function(e,t){if(e)for(var r=0;r<e.length;r++)e[r]=i('[bd-name="'+e[r]+'"]'),e[r].find("[bd-rank]").text(r+1),t.append(e[r])}}(jQuery);var services=pledgeit.services,views=birdiesforstjude.views;birdiesforstjude.views.MainView=function(){function e(){this._initialize(),this._attachEvents()}return e.prototype={_$golferLeaderboard:null,_$leaderboardEmpty:null,_leaderboardService:null,_itemsPerPage:10,_initialize:function(){this._$golferLeaderboard=$("[bd-leaderboard]"),this._$leaderboardEmpty=$("[bd-leaderboard-empty]"),this._leaderboardService=new services.LeaderboardService,this._getStats(),this._getGolfers(),window.Selectize&&$("select[selectize]").each($.proxy(function(e,t){$(t).selectize({onChange:$.proxy(this._handleSortChange,this,t)})},this))},_attachEvents:function(){$("[bd-show-more").on("click",$.proxy(this._handleShowMoreClick,this)),$("[bd-sort]").on("change",$.proxy(this._handleSortChange,this)),$("[bd-search]").on("keyup search",$.proxy(this._handleSearchKeyup,this)),$("[bd-anchor]").on("click",$.proxy(this._handleAnchorLinkClick,this))},_getStats:function(){this._leaderboardService.getTemplate("birdiesforstjude",{onSuccess:$.proxy(function(e){$("[bd-total-stats]").text(this._getValue(e.amountRaised)).removeClass("-preload")},this)})},_getGolfers:function(){birdies=0,promises=[],this._$golferLeaderboard.find("[bd-slug]").each($.proxy(function(e,r){promises.push(new Promise($.proxy(function(t,e){this._leaderboardService.getCampaign(r.getAttribute("bd-slug"),{onSuccess:$.proxy(function(e){$target=$(r),$target.find("[bd-amount]").text(this._getValue(e.amountRaised)).removeClass("-preload"),$target.find("[bd-performance]").text(e.performanceTotal).removeClass("-preload"),$target.find("[bd-donate]").attr("href",e.url+"/pledge").removeClass("-preload"),birdies+=e.performanceTotal,t()},this)})},this)))},this)),Promise.all(promises).then($.proxy(function(){$("[bd-birdie-stats]").text(birdies).removeClass("-preload"),this._$golferLeaderboard.find("[bd-slug]").reOrder(this._getSort("rank",this._$golferLeaderboard.find("[bd-slug]")),this._$golferLeaderboard),this._$golferLeaderboard.find("[bd-slug]").filter(":hidden").slice(0,this._itemsPerPage).removeClass("-preload"),this._$golferLeaderboard.removeClass("-preload")},this))},_getFilter:function(r,e){return r=r.toLowerCase(),this._mapItems(e).filter(function(e,t){return-1<t.name.toLowerCase().indexOf(r)}).map(function(e,t){return t.name})},_getSort:function(e,t){var r=this._mapItems(t);switch(r.sort(function(e,t){var r=e.name.toLowerCase(),i=t.name.toLowerCase();return r<i?-1:i<r?1:0}),e){case"birdies":r.sort(function(e,t){return t.birdies-e.birdies});break;case"rank":r.sort(function(e,t){return t.amount-e.amount})}return r.map(function(e,t){return t.name})},_getValue:function(e){return"$"+Number(parseFloat(e.replace(/[,\$]/g,"")).toFixed(0)).toLocaleString()},_mapItems:function(e){return e.map(function(e,t){var r=$(t);return{amount:parseFloat(r.find("[bd-amount]").text().replace(/[,\$]/g,"")),birdies:parseFloat(r.find("[bd-performance]").text()),name:r.attr("bd-name")}})},_handleAnchorLinkClick:function(e){anchor=document.querySelector(e.currentTarget.getAttribute("href")),void 0!==anchor.scrollIntoView&&(e.preventDefault(),anchor.scrollIntoView({behavior:"smooth"}))},_handleGolferSuccess:function(e,t){t.find("[bd-amount]").text("$"+e.amountRaised).removeClass("-preload")},_handleStatSuccess:function(e,t){t.text("$"+e.amountRaised).removeClass("-preload")},_handleSearchKeyup:function(e){if($target=$(e.currentTarget),this._$golferLeaderboard.find("[bd-slug]").addClass("-preload"),0===$target.val().length)return this._$golferLeaderboard.find("[bd-slug]").filter(":hidden").slice(0,this._itemsPerPage).removeClass("-preload"),$("[bd-show-more]").removeClass("-preload"),$target.addClass("empty"),this._$golferLeaderboard.show(),void this._$leaderboardEmpty.hide();for(var t=this._getFilter($target.val(),this._$golferLeaderboard.find("[bd-slug]")),r=0;r<t.length;r++)$('[bd-name="'+t[r]+'"]').removeClass("-preload");$("[bd-show-more]").addClass("-preload"),$target.removeClass("empty"),this._$golferLeaderboard.toggle(0<t.length),this._$leaderboardEmpty.toggle(0===t.length)},_handleSortChange:function(e){$target=$(e.currentTarget),sort=$target.find("option:selected").val(),this._$golferLeaderboard.find("[bd-slug]").reOrder(this._getSort(sort,this._$golferLeaderboard.find("[bd-slug]")),this._$golferLeaderboard),this._$golferLeaderboard.find("[bd-slug]").filter(":hidden").removeClass("-preload"),$("[bd-show-more]").addClass("-preload"),$("[bd-sort-rank]").hide(),$('[bd-sort-rank="'+sort+'"]').show()},_handleShowMoreClick:function(e){e.preventDefault(),this._$golferLeaderboard.find("[bd-slug]").filter(":hidden").removeClass("-preload"),$(e.currentTarget).addClass("-preload")}},e}(),$(function(){new birdiesforstjude.views.MainView});